(function(){function k(a,d){if(a instanceof Array)for(var e=0,c=a.length;e<c;e++)d(a[e],e);else for(e in a)d(e,a[e])}function u(a,d){var e,c,b={};arguments.length==1?c=a:arguments.length==2&&(c=d);if(c.constructor==Array){var g=c.length;e=function(b){for(ix=0;ix<g;ix++)if(n(b,c[ix])>-1)return!0;return!1}}else e=function(b){return n(b,c)>-1};return arguments.length==2?(b={},b[a]=e,b):e}function v(a){return a.length?a.slice?a.slice():m.call(a):p(a)}function w(){var a=m.call(arguments),d,e,c,b,g,f,i=
v(this instanceof Array?this:a.shift());a.length==2&&typeof a[0]=="string"&&(c={},c[a[0]]=a[1],a=[q(!0,{},c)]);for(e=0;e<a.length;e++)if(d=a[e],d.constructor==Function){d=d.single;b=i.length;for(f=b-1;f>=0;f--)d(i[f])&&(b-(f+1)&&(g=f+1,i.splice(g,b-g)),b=f);g=f+1;b-g&&i.splice(g,b-g)}else k(d,function(a,e){if(typeof e=="function"){b=i.length;for(f=b-1;f>=0;f--)c=i[f],a in c&&e(c[a],c)&&(b-(f+1)&&(g=f+1,i.splice(g,b-g)),b=f)}else{b=i.length;for(f=b-1;f>=0;f--)c=i[f],a in c&&c[a]===e&&(b-(f+1)&&(g=
f+1,i.splice(g,b-g)),b=f)}g=f+1;b-g&&i.splice(g,b-g)});return i}function x(a,d){var e,c,b={};arguments.length==1?c=a:arguments.length==2&&(c=d);c=c.toString().toLowerCase();e=function(b){return b.toString().toLowerCase().search(c)>-1};return arguments.length==2?(b={},b[a]=e,b):e}function y(){var a={};return function(d,e){if(arguments.length==1)return a[d];arguments.length==2&&(a[d]=e)}}function r(a){var d={};k(a,function(a){d[a]=!0});return d}function p(a){var d=[],e;for(e in a)d.push(a[e]);return d}
function q(a,d){var e,c,b,g,f,i=a||{},k=1,j=arguments.length,h=!1;l(i)=="b"&&(h=i,i=d||{},k=2);typeof i!=="object"&&typeof i!=="function"&&(i={});j===k&&(i=this,--k);for(;k<j;k++)if((e=arguments[k])!=null)for(c in e)b=i[c],g=e[c],i!==g&&(h&&g&&(g.constructor==Object||(f=l(g)=="a"))?(f?(f=!1,b=b&&l(constructor)=="a"?b:[]):b=b&&b.constructor==Object?b:{},i[c]=q(h,b,g)):g!==void 0&&(i[c]=g));return i}function z(a,d){var e=[],c;arguments.length==2?(c=a,a=d):c=this;if(c.constructor==Object){var e={},b;
for(b in c)c[b].constructor!=Function&&(e[b]=a.call(this,c[b]))}else k(c,function(){e.push(a.apply(this,arguments))});return e}var m=Array.prototype.slice,s=!1,t={},l,o={},C=Object.prototype.toString;k("Boolean Number String Function Array Date RegExp Object".split(" "),function(a){o["[object "+a+"]"]=a.toLowerCase().charAt(0)});l=function(a){return a==null?String(a):o[C.call(a)]||"o"};var n=[].indexOf?function(a,d){return a.indexOf(d)}:function(a,d){for(var e=a.length-1;e!=-1&&d!=a[e];e--);return e},
A=function(){var a={};return function(d,e){var c,b=arguments.length==1?d:e,g={};if(b.length)if(s&&b.length<10){var f=RegExp("^("+b.join("|")+")$");c=function(b){return f.test(b)}}else b.length<20?(c=b.join(","),c=a[c]?a[c]:a[c]=new Function("x","return x=="+b.join("||x=="))):c=function(a){return n(b,a)>-1};else c=l(b)=="f"?function(a){return n(b(),a)>-1}:b;return arguments.length==2?(g={},g[d]=c,g):c}}(),D=Object.keys?Object.keys:function(a){var d=[],e;for(e in a)d.push(e);return d},E=function(){var a=
{};return function(){return function(d,e){var c,b;if(l(d)=="s"){b=d;if(arguments.length==1)if(a[b])c=a[b];else{try{c=new Function("x, record","return x "+b)}catch(g){c={}}try{c.single=new Function("record","return "+d)}catch(f){}a[b]=c}arguments.length==2&&l(e)=="s"&&(c={},b=e,a[b]||(a[b]=new Function("x, record","return x "+b)),c[d]=a[b]);return c}}}}(),F=function(){var a={},d=[(Math.random()*Math.pow(2,32)).toString(36),(Math.random()*Math.pow(2,32)).toString(36)].join(":"),e=0,c;a.stain=function(a){e++;
c=d+e;for(var g=0,f=a.length;g<f;g++)a[g][c]=!0;return c};a.isStained=function(a){var e=a[c];e&&delete a[c];return e};return a}(),B=function(){var a={},d=0;a.stain=function(a){d++;for(var c=0,b=a.length;c<b;c++)a[c].constructor("i",d);return d};a.isStained=function(a){return a.constructor("i")==d};return a}();stainer=B;var G=r("has isin map group remove update where select find order each like ilike".split(" "));window.DB=function(a){function d(){for(var a=0;a<i.length;a++)i[a].call(h,j)}function e(a){for(var b in G)a[b]=
h[b];return a}function c(a){for(var b=0,c=a.length,e=[];b<c;b++)e[b]=j[a[b]];return e}var b={},g=0,f={},i=[],o=s?F:B,j=[],h=E();h.isin=A;h.has=u;h.ilike=h.like=x;h.each=z;h.map=r;h.setattrib=function(a,b){f[a]=b};h.get=function(a){return f[a].call(h,j)};h.group=function(a){var b={};filter=this instanceof Array?this:h.find();k(filter,function(c){b[c[a]]||(b[c[a]]=[]);b[c[a]].push(c)});return e(b)};h.sync=function(a){i.push(a)};h.order=function(a,b){var c,e=arguments.length,d;l(a)=="f"?c=a:l(a)=="s"&&
(e==1?d="x - y":e==2&&(l(b)=="s"&&(b.toLowerCase()=="asc"?d="x - y":b.toLowerCase()=="desc"&&(d="y - x")),typeof d=="undefined"&&(d=b)),l(d)=="s"&&(d=t[d]?t[d]:t[d]=new Function("x,y","return "+d)),c=function(b,c){return d(b[a],c[a])});return(this instanceof Array?this:h.find()).sort(c)};h.constrain=function(){var a=q,c=b,e;var d=arguments,g={};d.length==2?(g[d[0]]=d[1],e=g):d.length==1&&(e=d[0]);b=a(!0,c,e)};h.inverse=function(a){arguments.length==0&&this instanceof Array&&(a=this);var b;b=j;var c=
a;b=r(b);var c=r(c),d;for(d in c)b[d]&&delete b[d];b=D(b);return e(b)};h.where=h.find=function(){return e(w.apply(this,arguments.length?[j].concat(m.call(arguments)):[j]))};h.select=function(a){var b,c={};arguments.length>1?a=m.call(arguments):typeof a=="string"&&(a=[a]);b=this instanceof Array?this:h.find();for(var d=0,g=a.length;d<g;d++){column=a[d];for(var f=0,i=b.length;f<i;f++)row=b[f],column=="*"?c[f]=p(row):column in row&&(g>1?(c[f]||(c[f]=[]),c[f][d]=row[column]):c[f]=row[column])}return e(p(c))};
h.insert=function(a){var f=[],h=[],i=[];arguments.length>1?h=m.call(arguments):a.constructor==Array?h=a:h.push(a);b.unique&&(f=db.find().select(b.unique));k(h,function(a){if(!(b.unique&&n(f,a[b.unique])!=-1)){var c=g++,d;try{s?j.push(a):(d=new (y()),q(!0,d,a),j.push(d))}catch(e){if(!unsafe)a.constructor=y();j.push(a)}i.push(c)}});d();return e(c(i))};h.update=function(a,b){var c,g;c=this instanceof Array?v(this):h.find();arguments.length==2&&l(a)=="s"&&(g=a,a={},a[g]=b);k(a,function(a,b){l(b)=="f"?
k(c,function(c){c[a]=b(c)}):k(c,function(c){c[a]=b})});d();return e(c)};h.remove=function(a){var b,c,g=[];b=this instanceof Array?this:a instanceof Array?a:arguments.length>0?h.find(a):h.find();o.stain(b);b=j.length;for(var f=j.length-1;f>=0;f--)o.isStained(j[f])?g.push(j[f]):(b-(f+1)&&(c=f+1,j.splice(c,b-c)),b=f);c=f+1;b-c&&j.splice(c,b-c);d();return e(g)};if(arguments.length==1)switch(l(a)){case "a":h.insert(a);break;case "f":h.insert(a());break;case "s":return h.apply(this,arguments);case "o":h.insert(a)}else arguments.length>
1&&h.insert(m.call(arguments));h.__raw__=j;return h};window.DB.isin=A;window.DB.find=w;window.DB.has=u;window.DB.type=l;window.DB.each=z;window.DB.values=p;window.DB.ilike=window.DB.like=x;window.DB.unsafe=function(){s=!0};window.DB.reduceLeft=function(a,d){var e=new Function("ref,x","return ref "+d);return function(c){for(var b=c.length,d=a,f=0;f<b;f++)c[f]&&(d=e(d,c[f]));return d}};window.DB.reduceRight=function(a,d){var e=new Function("ref,x","return ref "+d);return function(c){for(var b=a,d=c.length-
1;d>0;d--)b=e(b,c[d]);return b}}})();
