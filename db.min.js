(function(){function j(a,d){if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)d(a[b],b);else for(b in a)d(b,a[b])}function q(a,d){var b,c,e={};arguments.length==1?c=a:arguments.length==2&&(c=d);if(c.constructor==Array){var g=c.length;b=function(a){for(ix=0;ix<g;ix++)if(m(a,c[ix])>-1)return!0;return!1}}else b=function(a){return m(a,c)>-1};return arguments.length==2?(e={},e[a]=b,e):b}function r(a){return a.length?a.slice?a.slice():l.call(a):o(a)}function s(){var a=l.call(arguments),d,b,c,e,g,f,i=
r(this instanceof Array?this:a.shift());a.length==2&&typeof a[0]=="string"&&(c={},c[a[0]]=a[1],a=[n(!0,{},c)]);for(b=0;b<a.length;b++)if(d=a[b],d.constructor==Function){d=d.single;e=i.length;for(f=e-1;f>=0;f--)d(i[f])&&(e-f+1&&(g=f+1,i.splice(g,e-g)),e=f);g=f+1;e-g&&i.splice(g,e-g)}else j(d,function(a,b){if(typeof b=="function"){e=i.length;for(f=e-1;f>=0;f--)c=i[f],a in c&&b(c[a],c)&&(e-f+1&&(g=f+1,i.splice(g,e-g)),e=f)}else{e=i.length;for(f=e-1;f>=0;f--)c=i[f],a in c&&c[a]===b&&(e-f+1&&(g=f+1,i.splice(g,
e-g)),e=f)}g=f+1;e-g&&i.splice(g,e-g)});return i}function t(a,d){var b,c,e={};arguments.length==1?c=a:arguments.length==2&&(c=d);b=k(c)=="array"?function(a){return m(c,a)>-1}:k(c)=="function"?function(a){return m(c(),a)>-1}:c;return arguments.length==2?(e={},e[a]=b,e):b}function u(a,d){var b,c,e={};arguments.length==1?c=a:arguments.length==2&&(c=d);c=c.toString().toLowerCase();b=function(a){return a.toString().toLowerCase().search(c)>-1};return arguments.length==2?(e={},e[a]=b,e):b}function v(){var a=
{};return function(){if(arguments.length==1)return a[arguments[0]];arguments.length==2&&(a[arguments[0]]=arguments[1])}}function p(a){var d={};j(a,function(a){d[a]=!0});return d}function o(a){var d=[],b;for(b in a)d.push(a[b]);return d}function z(a){var d=[];j(a,function(a){d.push(a.constructor("ix"))});return d}function n(){var a,d,b,c,e,g=arguments[0]||{},f=1,i=arguments.length,h=!1;typeof g==="boolean"&&(h=g,g=arguments[1]||{},f=2);typeof g!=="object"&&typeof g!=="function"&&(g={});i===f&&(g=this,
--f);for(;f<i;f++)if((a=arguments[f])!=null)for(d in a)b=g[d],c=a[d],g!==c&&(h&&c&&(c.constructor==Object||(e=k(c)=="array"))?(e?(e=!1,b=b&&k(constructor)=="array"?b:[]):b=b&&b.constructor==Object?b:{},g[d]=n(h,b,c)):c!==void 0&&(g[d]=c));return g}function A(){return function(){var a;if(typeof arguments[0]=="string"){if(arguments.length==1){try{a=new Function("x, record","return x "+arguments[0])}catch(d){a={}}try{a.single=new Function("record","return "+arguments[0])}catch(b){}}arguments.length==
2&&typeof arguments[1]=="string"&&(a={},a[arguments[0]]=new Function("x, record","return x "+arguments[1]));return a}}}function w(a){var d=[],b;arguments.length==2?(b=arguments[0],a=arguments[1]):b=this;if(b.constructor==Object){var d={},c;for(c in b)b[c].constructor!=Function&&(d[c]=a.call(this,b[c]))}else j(b,function(){d.push(a.apply(this,arguments))});return d}var l=Array.prototype.slice,k;if(!self.$||!self.$.type){var x={},B=Object.prototype.toString;j("Boolean Number String Function Array Date RegExp Object".split(" "),
function(a){x["[object "+a+"]"]=a.toLowerCase()});k=function(a){return a==null?String(a):x[B.call(a)]||"object"}}else k=$.type;var m=[].indexOf?function(a,d){return a.indexOf(d)}:function(a,d){for(var b=a.length-1;b!=-1&&d!=a[b];b--);return b},C=Object.keys?Object.keys:function(a){var d=[],b;for(b in a)d.push(b);return d},D=p("has isin map group remove update where select find order each like ilike".split(" "));window.DB=function(){function a(){for(var a=0;a<f.length;a++)f[a].call(h,i)}function d(a){for(var b in D)a[b]=
h[b];return a}function b(a){for(var b=0,c=a.length,d=[];b<c;b++)d[b]=i[a[b]];return d}var c={},e=0,g={},f=[],i=[],h=A();h.isin=t;h.has=q;h.ilike=h.like=u;h.each=w;h.map=p;h.setattrib=function(a,b){g[a]=b};h.get=function(a){return g[a].call(h,i)};h.group=function(a){var b={};filter=this instanceof Array?this:h.find();j(filter,function(c){b[c[a]]||(b[c[a]]=[]);b[c[a]].push(c)});return d(b)};h.sync=function(a){f.push(a)};h.order=function(){var a,b,c;typeof arguments[0]=="function"?b=arguments[0]:typeof arguments[0]==
"string"&&(a=arguments[0],arguments.length==1?c="x - y":arguments.length==2&&(typeof arguments[1]=="string"&&(arguments[1].toLowerCase()=="asc"?c="x - y":arguments[1].toLowerCase()=="desc"&&(c="y - x")),typeof c=="undefined"&&(c=arguments[1])),typeof c=="string"&&(c=new Function("x,y","return "+c)),b=function(b,d){return c(b[a],d[a])});return(this instanceof Array?this:h.find()).sort(b)};h.constrain=function(){var a=n,b=c,d;var e=arguments,g={};e.length==2?(g[e[0]]=e[1],d=g):e.length==1&&(d=e[0]);
c=a(!0,b,d)};h.inverse=function(a){arguments.length==0&&this instanceof Array&&(a=this);var b;b=i;var c=a;b=p(b);var c=p(c),e;for(e in c)b[e]&&delete b[e];b=C(b);return d(b)};h.where=h.find=function(){return d(s.apply(this,arguments.length?[i].concat(l.call(arguments)):[i]))};h.select=function(a){var b,c={};arguments.length>1?a=l.call(arguments):typeof a=="string"&&(a=[a]);b=this instanceof Array?this:h.find();for(var e=0,g=a.length;e<g;e++){column=a[e];for(var f=0,i=b.length;f<i;f++)row=b[f],column==
"*"?c[f]=o(row):column in row&&(g>1?(c[f]||(c[f]=[]),c[f][e]=row[column]):c[f]=row[column])}return d(o(c))};h.insert=function(g){var f=[],h=[],y=[];arguments.length>1?h=l.call(arguments):g.constructor==Array?h=g:h.push(g);c.unique&&(f=db.find().select(c.unique));j(h,function(a){if(!(c.unique&&m(f,a[c.unique])!=-1)){var b=e++,d;try{d=new (v()),n(!0,d,a),d.constructor("ix",b),i.push(d)}catch(g){a.constructor=v(),i.push(a)}y.push(b)}});a();return d(b(y))};h.update=function(b,c){var e,g;e=this instanceof
Array?r(this):h.find();arguments.length==2&&typeof arguments[0]=="string"&&(g=b,b={},b[g]=c);j(b,function(a,b){typeof b=="function"?j(e,function(c){c[a]=b(c)}):j(e,function(c){c[a]=b})});a();return d(e)};h.remove=function(b){var c,e,g=[];c=this instanceof Array?this:b instanceof Array?b:arguments.length>0?h.find(b):h.find();j(z(c),function(a){g.push(n(!0,{},i[a]));delete i[a]});c=i.length;for(var f=i.length-1;f>=0;f--)i[f]!==void 0&&(c-f+1&&(e=f+1,i.splice(e,c-e)),c=f);e=f+1;c-e&&i.splice(e,c-e);
a();return d(g)};if(arguments.length==1)if(arguments[0].constructor==Array)h.insert(arguments[0]);else if(arguments[0].constructor==Function)h.insert(arguments[0]());else if(arguments[0].constructor==Object)h.insert(arguments[0]);else{if(arguments[0].constructor==String)return h.apply(this,arguments)}else arguments.length>1&&h.insert(l.call(arguments));h.__raw__=i;return h};window.DB.isin=t;window.DB.find=s;window.DB.has=q;window.DB.type=k;window.DB.each=w;window.DB.values=o;window.DB.ilike=window.DB.like=
u;window.DB.reduceLeft=function(a,d){var b=new Function("ref,x","return ref "+d);return function(c){for(var e=c.length,d=a,f=0;f<e;f++)c[f]&&(d=b(d,c[f]));return d}};window.DB.reduceRight=function(a,d){var b=new Function("ref,x","return ref "+d);return function(c){for(var d=a,g=c.length-1;g>0;g--)d=b(d,c[g]);return d}}})();
