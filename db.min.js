(function(){function j(a,c){if(a instanceof Array)for(var b=0,d=a.length;b<d;b++)c(a[b],b);else for(b in a)c(b,a[b])}function t(a,c){var b,d,f={};arguments.length==1?d=a:arguments.length==2&&(d=c);if(d.constructor==Array){var g=d.length;b=function(a){for(ix=0;ix<g;ix++)if(o(a,d[ix])>-1)return!0;return!1}}else b=function(a){return o(a,d)>-1};return arguments.length==2?(f={},f[a]=b,f):b}function r(a){return a.length?a.slice?a.slice():m.call(a):s(a)}function u(){var a=m.call(arguments),c,b;b=this instanceof Array?r(this):r(a.shift());a.length==2&&typeof a[0]=="string"&&(c={},c[a[0]]=a[1],a=[p(!0,{},c)]);for(c=0;c<a.length;c++)if(a[c]&&a[c].constructor==Function){for(var d,f=b.length,g=a[c],h=b.length-1;h>=0;h--)g.single(b[h])&&(d=h+1,b.splice(d,f-d),f=h);d=h+1;f-d>0&&b.splice(d,f-d)}else j(a[c],function(a,c){for(var k,d=b.length,n=b.length-1;n>=0;n--)if(k=b[n],a in k){if(typeof c=="function"){if(!c(k[a],k))continue}else if(k[a]!==c)continue;k=n+1;b.splice(k,d-k);d=n}k=n+1;d-k>0&&b.splice(k,d-k)});return b} function v(a,c){var b,d,f={};arguments.length==1?d=a:arguments.length==2&&(d=c);b=l(d)=="array"?function(a){return o(d,a)>-1}:l(d)=="function"?function(a){return o(d(),a)>-1}:d;return arguments.length==2?(f={},f[a]=b,f):b}function w(a,c){var b,d,f={};arguments.length==1?d=a:arguments.length==2&&(d=c);d=d.toString().toLowerCase();b=function(a){return a.toString().toLowerCase().search(d)>-1};return arguments.length==2?(f={},f[a]=b,f):b}function x(){var a={};return function(){if(arguments.length==1)return a[arguments[0]]; arguments.length==2&&(a[arguments[0]]=arguments[1])}}function q(a){var c={};j(a,function(a){c[a]=!0});return c}function s(a){var c=[],b;for(b in a)c.push(a[b]);return c}function B(a){var c=[];j(a,function(a){c.push(a.constructor("ix"))});return c}function p(){var a,c,b,d,f,g=arguments[0]||{},h=1,i=arguments.length,e=!1;typeof g==="boolean"&&(e=g,g=arguments[1]||{},h=2);typeof g!=="object"&&typeof g!=="function"&&(g={});i===h&&(g=this,--h);for(;h<i;h++)if((a=arguments[h])!=null)for(c in a)b=g[c],d= a[c],g!==d&&(e&&d&&(d.constructor==Object||(f=l(d)=="array"))?(f?(f=!1,b=b&&l(constructor)=="array"?b:[]):b=b&&b.constructor==Object?b:{},g[c]=p(e,b,d)):d!==void 0&&(g[c]=d));return g}function C(){return function(){var a;if(typeof arguments[0]=="string"){if(arguments.length==1){try{a=new Function("x, record","return x "+arguments[0])}catch(c){a={}}try{a.single=new Function("record","return "+arguments[0])}catch(b){}}arguments.length==2&&typeof arguments[1]=="string"&&(a={},a[arguments[0]]=new Function("x, record", "return x "+arguments[1]));return a}}}function y(a){var c=[],b;arguments.length==2?(b=arguments[0],a=arguments[1]):b=this;if(b.constructor==Object){var c={},d;for(d in b)b[d].constructor!=Function&&(c[d]=a.call(this,b[d]))}else j(b,function(){c.push(a.apply(this,arguments))});return c}var m=Array.prototype.slice,l;if(!self.$||!self.$.type){var z={},D=Object.prototype.toString;j("Boolean Number String Function Array Date RegExp Object".split(" "),function(a){z["[object "+a+"]"]=a.toLowerCase()});l= function(a){return a==null?String(a):z[D.call(a)]||"object"}}else l=$.type;var o=[].indexOf?function(a,c){return a.indexOf(c)}:function(a,c){if(a==null)return-1;for(var b=a.length-1;b!=-1&&c!=a[b];b--);return ix},A=Object.keys?Object.keys:function(a){var c=[],b;for(b in a)c.push(b);return c},E=q("has isin map group remove update where select find order each like ilike".split(" "));window.DB=function(){function a(){for(var a=0;a<h.length;a++)h[a].call(e,i)}function c(a){for(var b in E)a[b]=e[b];return a} function b(a){for(var b=0,c=a.length,d=Array(c);b<c;b++)d[b]=i[a[b]];return d}var d={},f=0,g={},h=[],i={},e=C();e.isin=v;e.has=t;e.ilike=e.like=w;e.each=y;e.map=q;e.setattrib=function(a,b){g[a]=b};e.get=function(a){return g[a].call(e,i)};e.group=function(a){var b={};filter=this instanceof Array?this:e.find();j(filter,function(c){b[c[a]]||(b[c[a]]=[]);b[c[a]].push(c)});return c(b)};e.sync=function(a){h.push(a)};e.order=function(){var a,b,c;typeof arguments[0]=="function"?b=arguments[0]:typeof arguments[0]== "string"&&(a=arguments[0],arguments.length==1?c="x - y":arguments.length==2&&(typeof arguments[1]=="string"&&(arguments[1].toLowerCase()=="asc"?c="x - y":arguments[1].toLowerCase()=="desc"&&(c="y - x")),typeof c=="undefined"&&(c=arguments[1])),typeof c=="string"&&(c=new Function("x,y","return "+c)),b=function(b,d){return c(b[a],d[a])});return(this instanceof Array?this:e.find()).sort(b)};e.constrain=function(){var a=p,b=d,c;var e=arguments,f={};e.length==2?(f[e[0]]=e[1],c=f):e.length==1&&(c=e[0]); d=a(!0,b,c)};e.inverse=function(a){arguments.length==0&&this instanceof Array&&(a=this);var b;b=A(i);var d=a;b=q(b);var d=q(d),e;for(e in d)b[e]&&delete b[e];b=A(b);return c(b)};e.where=e.find=function(){return c(u.apply(this,arguments.length?[i].concat(m.call(arguments)):[i]))};e.select=function(a){var b,d,f=[];arguments.length>1?a=m.call(arguments):typeof a=="string"&&(a=[a]);d=this instanceof Array?this:e.find();j(d,function(c){b=[];j(a,function(a){a=="*"?b=b.concat(s(c)):b.push(c[a])});b.length== 1&&(b=b[0]);f.push(b)});return c(f)};e.insert=function(e){var g=[],h=[],l=[];arguments.length>1?h=m.call(arguments):e.constructor==Array?h=e:h.push(e);d.unique&&(g=db.find().select(d.unique));j(h,function(a){if(!(d.unique&&o(g,a[d.unique])!=-1)){var b=f++;try{i[b]=new (x()),p(!0,i[b],a),i[b].constructor("ix",b)}catch(c){i[b]=a,i[b].constructor=x()}l.push(b)}});a();return c(b(l))};e.update=function(b,d){var f,g;f=this instanceof Array?r(this):e.find();arguments.length==2&&typeof arguments[0]=="string"&& (g=b,b={},b[g]=d);j(b,function(a,b){typeof b=="function"?j(f,function(c){c[a]=b(c)}):j(f,function(c){c[a]=b})});a();return c(f)};e.remove=function(b){var d=[],b=this instanceof Array?this:b instanceof Array?b:e.find(b);j(B(b),function(a){d.push(p(!0,{},i[a]));delete i[a]});a();return c(d)};if(arguments.length==1)if(arguments[0].constructor==Array)e.insert(arguments[0]);else if(arguments[0].constructor==Function)e.insert(arguments[0]());else if(arguments[0].constructor==Object)e.insert(arguments[0]); else{if(arguments[0].constructor==String)return e.apply(this,arguments)}else arguments.length>1&&e.insert(m.call(arguments));e.__raw__=i;return e};window.DB.isin=v;window.DB.find=u;window.DB.has=t;window.DB.type=l;window.DB.each=y;window.DB.values=s;window.DB.ilike=window.DB.like=w;window.DB.reduceLeft=function(a,c){var b=new Function("ref,x","return ref "+c);return function(c){for(var f=c.length,g=a,h=0;h<f;h++)c[h]&&(g=b(g,c[h]));return g}};window.DB.reduceRight=function(a,c){var b=new Function("ref,x", "return ref "+c);return function(c){for(var f=a,g=c.length-1;g>0;g--)f=b(f,c[g]);return f}}})();
