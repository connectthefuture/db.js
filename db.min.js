(function(){function y(a,d){var c=arguments.length,b=c==1?a:d,h,e={};j.isArr(b)?(c=b.length,h=function(a){for(var e=0;e<c;e++)if(n(a,b[e])>-1)return!0;return!1}):h=function(a){return n(a,b)>-1};return c==2?(e={},e[a]=h,e):h}function u(a){return a.length?m.call(a):p(a)}function z(){var a=m.call(arguments),d,c,b,h,e,f,i,k={},g=u(j.isArr(this)?this:a.shift());a.length==2&&j.isStr(a[0])&&(b={},b[a[0]]=a[1],a=[o({},b)]);for(c=0;c<a.length;c++)if(d=a[c],j.isFun(d)){d=d.single;k={};for(e=g.length,i=e-1;i>=
0;i--){b=g[i];if(b in k){if(!k[b])continue}else if(!(k[b]=d(b)))continue;e-(i+1)&&(f=i+1,g.splice(f,e-f));e=i}f=i+1;e-f&&g.splice(f,e-f)}else l(d,function(a,c){if(j.isFun(c)){k={};for(e=g.length,i=e-1;i>=0;i--)b=g[i],a in b&&(h=b[a],c(h,b)&&(e-(i+1)&&(f=i+1,g.splice(f,e-f)),e=i))}else for(e=g.length,i=e-1;i>=0;i--)b=g[i],a in b&&b[a]===c&&(e-(i+1)&&(f=i+1,g.splice(f,e-f)),e=i);f=i+1;e-f&&g.splice(f,e-f)});return g}function A(a,d){var c,b=arguments.length,h,e={};b==1?h=a:b==2&&(h=d);h=h.toString().toLowerCase();
c=function(a){return a.toString().toLowerCase().search(h)>-1};return b==2?(e={},e[a]=c,e):c}function v(a){var d={x:a};return function(a,b){arguments.length==2&&(d[a]=b);return d[a]}}function q(a){var d={};l(a,function(a){d[a]=!0});return d}function p(a){var d=[],c;for(c in a)d.push(a[c]);return d}function o(a,d){for(var c,b,h,e,f=arguments.length,i=0;i<f;i++){c=arguments[i];for(var k in c)b=a[k],h=c[k],a!==h&&(h&&(h.constructor==Object||(e=j.isArr(h)))?(e?(e=!1,b=b&&j.isArr(constructor)?b:[]):b=b&&
b.constructor==Object?b:{},a[k]=o(b,h)):h!==void 0&&(a[k]=h))}return a}function B(a,d){var c=[],b;arguments.length==2?(b=a,a=d):b=this;if(j.isArr(b))c=w(b,a);else{var c={},h;for(h in b)j.isFun(b[h])||(c[h]=a.call(this,b[h]))}return c}var m=Array.prototype.slice,r=Object.prototype.toString,s={},x={},j={isFun:function(a){return!(!a||!a.constructor||!a.call||!a.apply)},isStr:function(a){return!!(a===""||a&&a.charCodeAt&&a.substr)},isNum:function(a){return r.call(a)==="[object Number]"},isArr:[].isArray||
function(a){return r.call(a)==="[object Array]"},isObj:function(a){return a==null?String(a)=="object":r.call(a)==="[object Object]"||!0}},n=[].indexOf?function(a,d){return a.indexOf(d)}:function(a,d){for(var c=a.length-1;c!=-1&&d!=a[c];c--);return c},C={}.keys||function(a){var d=[],c;for(c in a)d.push(c);return d},w=[].map?function(a,d){return a.map(d)}:function(a,d){for(var c=[],b=0,h=obj.length;b<h;b++)c.push(d(obj[b],b));return c},l=[].forEach?function(a,d){if(j.isArr(a))a.forEach(d);else for(var c in a)d(c,
a[c])}:function(a,d){if(j.isArr(a))for(var c=0,b=a.length;c<b;c++)d(a[c],c);else for(c in a)d(c,a[c])};l("< <= > >= == === != !==".split(" "),function(a){x[a]=Function("rhs","return function(x){return x"+a+"rhs}")});var D=function(){var a={};return function(d,c){var b,h=arguments.length,e=h==1?d:c||[],f={};e.length?e.length<20&&j.isNum(e[0])?(b=e.join(","),b=a[b]?a[b]:a[b]=new Function("x","return x=="+e.join("||x=="))):b=function(a){return n(e,a)>-1}:b=j.isFun(e)?function(a){return n(e(),a)>-1}:
e;return h==2?(f={},f[d]=b,f):b}}(),E=function(){var a=/^\s*([=<>!]+)['"]*(.*)$/,d,c={};return function(){return function(b,h){var e,f;if(j.isStr(b)){f=b;if(arguments.length==1)if(c[f])e=c[f];else{try{e=new Function("x,rec","return x "+f)}catch(i){e={}}try{e.single=new Function("rec","return "+b)}catch(k){}c[f]=e}arguments.length==2&&j.isStr(h)&&(e={},f=h,c[f]||(c[f]=(d=f.match(a))!==null?x[d[1]](d[2].replace(/['"]$/,"")):new Function("x,rec","return x "+f)),e[b]=c[f]);return e}}}}();(function(){var a=
{},d=(Math.random()*Math.pow(2,32)).toString(36),c=1,b;a.stain=function(a){c++;b=d+c;for(var e=0,f=a.length;e<f;e++)a[e][b]=!0;return b};a.isStained=function(a){var c=a[b];c&&delete a[b];return c};return a})();var t=function(){var a={},d=0;a.stain=function(a){d++;for(var b=0,h=a.length;b<h;b++)a[b].constructor("i",d);return d};a.isStained=function(a){return a.constructor("i")==d};return a}();stainer=t;var F=q("has isin group remove update where select find order each like".split(" "));self.DB=function(a,
d){function c(a){return a}function b(){for(var a=0,b=i.length;a<b;a++)i[a].call(g,k)}function h(a){for(var b in F)a[b]=g[b];return a}function e(a){for(var b=[],c=0,e=a.length;c<e;c++)b[c]=k[a[c]];return b}var f={},i=[],k=[];k._indexCache={};var g=E();g.isin=D;g.has=y;g.like=A;g.each=B;g.group=function(a){var b={};filter=j.isArr(this)?this:g.find();l(filter,function(c){b[c[a]]||(b[c[a]]=[]);b[c[a]].push(c)});return h(b)};g.sync=function(a){i.push(a)};g.order=g.sort=function(a,b){var c,e=arguments.length,
d;j.isFun(a)?c=a:j.isStr(a)&&(e==1?d="x-y":e==2&&(j.isStr(b)&&(b.toLowerCase()=="asc"?d="x-y":b.toLowerCase()=="desc"&&(d="y-x")),typeof d=="undefined"&&(d=b)),j.isStr(d)&&(d=s[d]?s[d]:s[d]=new Function("x,y","return "+d)),c=function(b,c){return d(b[a],c[a])});return(j.isArr(this)?this:g.find()).sort(c)};g.constrain=function(){var a=o,b=f,c;var d=arguments,e={};d.length==2?(e[d[0]]=d[1],c=e):d.length==1&&(c=d[0]);f=a(b,c)};g.inverse=function(a){arguments.length==0&&j.isArr(this)&&(a=this);var b;b=
k;var c=a;b=q(b);var c=q(c),d;for(d in c)b[d]&&delete b[d];b=C(b);return h(b)};g.where=g.find=function(){return h(z.apply(this,arguments.length?[k].concat(m.call(arguments)):[k]))};g.findFirst=function(){var a=g.find.apply(this,m.call(arguments));return a.length?a[0]:{}};g.select=function(a){var b,c={};arguments.length>1?a=m.call(arguments):j.isStr(a)&&(a=[a]);b=j.isArr(this)?this:g.find();l(a,function(a,d){if(a=="*")c=w(b,p);else for(var e=0,g=b.length;e<g;e++)row=b[e],a in row&&(g>1?(c[e]||(c[e]=
[]),c[e][d]=row[a]):c[e]=row[a])});return h(p(c))};g.insert=function(a){var d={},g=[],i=[];arguments.length>1?g=m.call(arguments):j.isArr(a)?g=a:g.push(a);f.unique&&l(k,function(a,b){d[a[f.unique]]=b});l(g,function(a){if(f.unique&&a[f.unique]in d)i.push(d[a[f.unique]]);else{var b=k.length,c;try{c=new (v(b)),o(c,a),k.push(c)}catch(e){if(!unsafe)a.constructor=v(b);k.push(a)}i.push(b)}});b();return h(c(e(i)))};g.update=function(a,c){var d,e;d=j.isArr(this)?u(this):g.find();arguments.length==2&&j.isStr(a)&&
(e=a,a={},a[e]=c);j.isFun(a)?l(d,a):l(a,function(a,b){j.isFun(b)?l(d,function(c){c[a]=b(c)}):l(d,function(c){c[a]=b})});b();return h(d)};g.remove=function(a){var c,d,e=[];c=j.isArr(this)?this:j.isArr(a)?a:arguments.length>0?g.find(a):g.find();t.stain(c);c=k.length;for(var f=k.length-1;f>=0;f--)t.isStained(k[f])?e.push(k[f]):(c-(f+1)&&(d=f+1,k.splice(d,c-d)),c=f);d=f+1;c-d&&k.splice(d,c-d);b();return h(e)};if(arguments.length==1)if(j.isArr(a))g.insert(a);else if(j.isFun(a))g.insert(a());else if(j.isStr(a))return g.apply(this,
arguments);else j.isObj(a)&&g.insert(a);else arguments.length>1&&g.insert(m.call(arguments));g.__raw__=k;return g}})();
