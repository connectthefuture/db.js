(function(){function j(a,e){if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)e(a[b],b);else for(b in a)e(b,a[b])}function r(a,e){var b,c,d={};arguments.length==1?c=a:arguments.length==2&&(c=e);if(c.constructor==Array){var g=c.length;b=function(a){for(ix=0;ix<g;ix++)if(m(a,c[ix])>-1)return!0;return!1}}else b=function(a){return m(a,c)>-1};return arguments.length==2?(d={},d[a]=b,d):b}function s(a){return a.length?a.slice?a.slice():l.call(a):n(a)}function t(){var a=l.call(arguments),e,b,c,d,g,f,i=
s(this instanceof Array?this:a.shift());a.length==2&&typeof a[0]=="string"&&(c={},c[a[0]]=a[1],a=[q(!0,{},c)]);for(b=0;b<a.length;b++)if(e=a[b],e.constructor==Function){e=e.single;d=i.length;for(f=d-1;f>=0;f--)e(i[f])&&(d-(f+1)&&(g=f+1,i.splice(g,d-g)),d=f);g=f+1;d-g&&i.splice(g,d-g)}else j(e,function(a,b){if(typeof b=="function"){d=i.length;for(f=d-1;f>=0;f--)c=i[f],a in c&&b(c[a],c)&&(d-(f+1)&&(g=f+1,i.splice(g,d-g)),d=f)}else{d=i.length;for(f=d-1;f>=0;f--)c=i[f],a in c&&c[a]===b&&(d-(f+1)&&(g=
f+1,i.splice(g,d-g)),d=f)}g=f+1;d-g&&i.splice(g,d-g)});return i}function u(a,e){var b,c,d={};arguments.length==1?c=a:arguments.length==2&&(c=e);b=k(c)=="array"?function(a){return m(c,a)>-1}:k(c)=="function"?function(a){return m(c(),a)>-1}:c;return arguments.length==2?(d={},d[a]=b,d):b}function v(a,e){var b,c,d={};arguments.length==1?c=a:arguments.length==2&&(c=e);c=c.toString().toLowerCase();b=function(a){return a.toString().toLowerCase().search(c)>-1};return arguments.length==2?(d={},d[a]=b,d):b}
function o(a){var e={};j(a,function(a){e[a]=!0});return e}function n(a){var e=[],b;for(b in a)e.push(a[b]);return e}function q(){var a,e,b,c,d,g=arguments[0]||{},f=1,i=arguments.length,h=!1;typeof g==="boolean"&&(h=g,g=arguments[1]||{},f=2);typeof g!=="object"&&typeof g!=="function"&&(g={});i===f&&(g=this,--f);for(;f<i;f++)if((a=arguments[f])!=null)for(e in a)b=g[e],c=a[e],g!==c&&(h&&c&&(c.constructor==Object||(d=k(c)=="array"))?(d?(d=!1,b=b&&k(constructor)=="array"?b:[]):b=b&&b.constructor==Object?
b:{},g[e]=q(h,b,c)):c!==void 0&&(g[e]=c));return g}function A(){return function(){var a;if(typeof arguments[0]=="string"){if(arguments.length==1){try{a=new Function("x, record","return x "+arguments[0])}catch(e){a={}}try{a.single=new Function("record","return "+arguments[0])}catch(b){}}arguments.length==2&&typeof arguments[1]=="string"&&(a={},a[arguments[0]]=new Function("x, record","return x "+arguments[1]));return a}}}function w(a){var e=[],b;arguments.length==2?(b=arguments[0],a=arguments[1]):
b=this;if(b.constructor==Object){var e={},c;for(c in b)b[c].constructor!=Function&&(e[c]=a.call(this,b[c]))}else j(b,function(){e.push(a.apply(this,arguments))});return e}var B=[(Math.random()*Math.pow(2,32)).toString(36),(Math.random()*Math.pow(2,32)).toString(36)].join(":"),x=0,p,l=Array.prototype.slice,k;if(!self.$||!self.$.type){var y={},C=Object.prototype.toString;j("Boolean Number String Function Array Date RegExp Object".split(" "),function(a){y["[object "+a+"]"]=a.toLowerCase()});k=function(a){return a==
null?String(a):y[C.call(a)]||"object"}}else k=$.type;var m=[].indexOf?function(a,e){return a.indexOf(e)}:function(a,e){for(var b=a.length-1;b!=-1&&e!=a[b];b--);return b},D=Object.keys?Object.keys:function(a){var e=[],b;for(b in a)e.push(b);return e},E=o("has isin map group remove update where select find order each like ilike".split(" "));window.DB=function(){function a(){for(var a=0;a<f.length;a++)f[a].call(h,i)}function e(a){for(var b in E)a[b]=h[b];return a}function b(a){for(var b=0,c=a.length,
e=[];b<c;b++)e[b]=i[a[b]];return e}var c={},d=0,g={},f=[],i=[],h=A();h.isin=u;h.has=r;h.ilike=h.like=v;h.each=w;h.map=o;h.setattrib=function(a,b){g[a]=b};h.get=function(a){return g[a].call(h,i)};h.group=function(a){var b={};filter=this instanceof Array?this:h.find();j(filter,function(c){b[c[a]]||(b[c[a]]=[]);b[c[a]].push(c)});return e(b)};h.sync=function(a){f.push(a)};h.order=function(){var a,b,c;typeof arguments[0]=="function"?b=arguments[0]:typeof arguments[0]=="string"&&(a=arguments[0],arguments.length==
1?c="x - y":arguments.length==2&&(typeof arguments[1]=="string"&&(arguments[1].toLowerCase()=="asc"?c="x - y":arguments[1].toLowerCase()=="desc"&&(c="y - x")),typeof c=="undefined"&&(c=arguments[1])),typeof c=="string"&&(c=new Function("x,y","return "+c)),b=function(b,e){return c(b[a],e[a])});return(this instanceof Array?this:h.find()).sort(b)};h.constrain=function(){var a=q,b=c,e;var d=arguments,g={};d.length==2?(g[d[0]]=d[1],e=g):d.length==1&&(e=d[0]);c=a(!0,b,e)};h.inverse=function(a){arguments.length==
0&&this instanceof Array&&(a=this);var b;b=i;var c=a;b=o(b);var c=o(c),d;for(d in c)b[d]&&delete b[d];b=D(b);return e(b)};h.where=h.find=function(){return e(t.apply(this,arguments.length?[i].concat(l.call(arguments)):[i]))};h.select=function(a){var b,c={};arguments.length>1?a=l.call(arguments):typeof a=="string"&&(a=[a]);b=this instanceof Array?this:h.find();for(var d=0,g=a.length;d<g;d++){column=a[d];for(var f=0,i=b.length;f<i;f++)row=b[f],column=="*"?c[f]=n(row):column in row&&(g>1?(c[f]||(c[f]=
[]),c[f][d]=row[column]):c[f]=row[column])}return e(n(c))};h.insert=function(g){var f=[],h=[],z=[];arguments.length>1?h=l.call(arguments):g.constructor==Array?h=g:h.push(g);c.unique&&(f=db.find().select(c.unique));j(h,function(a){if(!(c.unique&&m(f,a[c.unique])!=-1)){var b=d++;try{i.push(a)}catch(e){i.push(a)}z.push(b)}});a();return e(b(z))};h.update=function(b,c){var d,g;d=this instanceof Array?s(this):h.find();arguments.length==2&&typeof arguments[0]=="string"&&(g=b,b={},b[g]=c);j(b,function(a,
b){typeof b=="function"?j(d,function(c){c[a]=b(c)}):j(d,function(c){c[a]=b})});a();return e(d)};h.remove=function(b){var c,d,g=[];c=this instanceof Array?this:b instanceof Array?b:arguments.length>0?h.find(b):h.find();x++;p=B+x;var f=0;for(d=c.length;f<d;f++)c[f][p]=!0;c=i.length;for(f=i.length-1;f>=0;f--)(d=i[f][p])&&delete i[f][p],d?g.push(i[f]):(c-(f+1)&&(d=f+1,i.splice(d,c-d)),c=f);d=f+1;c-d&&i.splice(d,c-d);a();return e(g)};if(arguments.length==1)if(arguments[0].constructor==Array)h.insert(arguments[0]);
else if(arguments[0].constructor==Function)h.insert(arguments[0]());else if(arguments[0].constructor==Object)h.insert(arguments[0]);else{if(arguments[0].constructor==String)return h.apply(this,arguments)}else arguments.length>1&&h.insert(l.call(arguments));h.__raw__=i;return h};window.DB.isin=u;window.DB.find=t;window.DB.has=r;window.DB.type=k;window.DB.each=w;window.DB.values=n;window.DB.ilike=window.DB.like=v;window.DB.reduceLeft=function(a,e){var b=new Function("ref,x","return ref "+e);return function(c){for(var d=
c.length,e=a,f=0;f<d;f++)c[f]&&(e=b(e,c[f]));return e}};window.DB.reduceRight=function(a,e){var b=new Function("ref,x","return ref "+e);return function(c){for(var d=a,e=c.length-1;e>0;e--)d=b(d,c[e]);return d}}})();
