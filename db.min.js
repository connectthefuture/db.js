(function(){function l(a,f){if(a instanceof Array)for(var e=0,c=a.length;e<c;e++)f(a[e],e);else for(e in a)f(e,a[e])}function u(a,f){var e=arguments.length,c,b,d={};e==1?b=a:e==2&&(b=f);j(b)=="a"?(e=b.length,c=function(a){for(ix=0;ix<e;ix++)if(o(a,b[ix])>-1)return!0;return!1}):c=function(a){return o(a,b)>-1};return e==2?(d={},d[a]=c,d):c}function v(a){return a.length?a.slice?a.slice():n.call(a):p(a)}function w(){var a=n.call(arguments),f,e,c,b,d,g,i=v(this instanceof Array?this:a.shift());a.length==
2&&j(a[0])=="s"&&(c={},c[a[0]]=a[1],a=[q(!0,{},c)]);for(e=0;e<a.length;e++)if(f=a[e],j(f)=="f"){f=f.single;b=i.length;for(g=b-1;g>=0;g--)f(i[g])&&(b-(g+1)&&(d=g+1,i.splice(d,b-d)),b=g);d=g+1;b-d&&i.splice(d,b-d)}else l(f,function(a,e){if(j(e)=="f"){b=i.length;for(g=b-1;g>=0;g--)c=i[g],a in c&&e(c[a],c)&&(b-(g+1)&&(d=g+1,i.splice(d,b-d)),b=g)}else{b=i.length;for(g=b-1;g>=0;g--)c=i[g],a in c&&c[a]===e&&(b-(g+1)&&(d=g+1,i.splice(d,b-d)),b=g)}d=g+1;b-d&&i.splice(d,b-d)});return i}function x(a,f){var e,
c=arguments.length,b,d={};c==1?b=a:c==2&&(b=f);b=b.toString().toLowerCase();e=function(a){return a.toString().toLowerCase().search(b)>-1};return c==2?(d={},d[a]=e,d):e}function y(){var a={};return function(f,e){if(arguments.length==1)return a[f];arguments.length==2&&(a[f]=e)}}function r(a){var f={};l(a,function(a){f[a]=!0});return f}function p(a){var f=[],e;for(e in a)f.push(a[e]);return f}function q(a,f){var e,c,b,d,g,i=a||{},m=1,k=arguments.length,h=!1;j(i)=="b"&&(h=i,i=f||{},m=2);typeof i!=="object"&&
j(i)!=="f"&&(i={});k===m&&(i=this,--m);for(;m<k;m++)if((e=arguments[m])!=null)for(c in e)b=i[c],d=e[c],i!==d&&(h&&d&&(d.constructor==Object||(g=j(d)=="a"))?(g?(g=!1,b=b&&j(constructor)=="a"?b:[]):b=b&&b.constructor==Object?b:{},i[c]=q(h,b,d)):d!==void 0&&(i[c]=d));return i}function z(a,f){var e=[],c;arguments.length==2?(c=a,a=f):c=this;if(c.constructor==Object){var e={},b;for(b in c)j(c[b])!="f"&&(e[b]=a.call(this,c[b]))}else l(c,function(){e.push(a.apply(this,arguments))});return e}var n=Array.prototype.slice,
s=!1,t={},j,A={},D=Object.prototype.toString;l("Boolean Number String Function Array Date RegExp Object".split(" "),function(a){A["[object "+a+"]"]=a.toLowerCase().charAt(0)});j=function(a){return a==null?String(a):A[D.call(a)]||"o"};var o=[].indexOf?function(a,f){return a.indexOf(f)}:function(a,f){for(var e=a.length-1;e!=-1&&f!=a[e];e--);return e},B=function(){var a={};return function(f,e){var c,b=arguments.length,d=b==1?f:e,g={};if(d.length)if(s&&d.length<10){var i=RegExp("^("+d.join("|")+")$");
c=function(a){return i.test(a)}}else d.length<20?(c=d.join(","),c=a[c]?a[c]:a[c]=new Function("x","return x=="+d.join("||x=="))):c=function(a){return o(d,a)>-1};else c=j(d)=="f"?function(a){return o(d(),a)>-1}:d;return b==2?(g={},g[f]=c,g):c}}(),E=Object.keys?Object.keys:function(a){var f=[],e;for(e in a)f.push(e);return f},F=function(){var a={};return function(){return function(f,e){var c,b;if(j(f)=="s"){b=f;if(arguments.length==1)if(a[b])c=a[b];else{try{c=new Function("x, record","return x "+b)}catch(d){c=
{}}try{c.single=new Function("record","return "+f)}catch(g){}a[b]=c}arguments.length==2&&j(e)=="s"&&(c={},b=e,a[b]||(a[b]=new Function("x, record","return x "+b)),c[f]=a[b]);return c}}}}(),G=function(){var a={},f=[(Math.random()*Math.pow(2,32)).toString(36),(Math.random()*Math.pow(2,32)).toString(36)].join(":"),e=0,c;a.stain=function(a){e++;c=f+e;for(var d=0,g=a.length;d<g;d++)a[d][c]=!0;return c};a.isStained=function(a){var e=a[c];e&&delete a[c];return e};return a}(),C=function(){var a={},f=0;a.stain=
function(a){f++;for(var c=0,b=a.length;c<b;c++)a[c].constructor("i",f);return f};a.isStained=function(a){return a.constructor("i")==f};return a}();stainer=C;var H=r("has isin map group remove update where select find order each like ilike".split(" "));window.DB=function(a){function f(){for(var a=0;a<i.length;a++)i[a].call(h,k)}function e(a){for(var b in H)a[b]=h[b];return a}function c(a){for(var b=0,c=a.length,e=[];b<c;b++)e[b]=k[a[b]];return e}var b={},d=0,g={},i=[],m=s?G:C,k=[],h=F();h.isin=B;h.has=
u;h.ilike=h.like=x;h.each=z;h.map=r;h.setattrib=function(a,b){g[a]=b};h.get=function(a){return g[a].call(h,k)};h.group=function(a){var b={};filter=this instanceof Array?this:h.find();l(filter,function(c){b[c[a]]||(b[c[a]]=[]);b[c[a]].push(c)});return e(b)};h.sync=function(a){i.push(a)};h.order=function(a,b){var c,e=arguments.length,d;j(a)=="f"?c=a:j(a)=="s"&&(e==1?d="x - y":e==2&&(j(b)=="s"&&(b.toLowerCase()=="asc"?d="x - y":b.toLowerCase()=="desc"&&(d="y - x")),typeof d=="undefined"&&(d=b)),j(d)==
"s"&&(d=t[d]?t[d]:t[d]=new Function("x,y","return "+d)),c=function(b,c){return d(b[a],c[a])});return(this instanceof Array?this:h.find()).sort(c)};h.constrain=function(){var a=q,c=b,e;var d=arguments,f={};d.length==2?(f[d[0]]=d[1],e=f):d.length==1&&(e=d[0]);b=a(!0,c,e)};h.inverse=function(a){arguments.length==0&&this instanceof Array&&(a=this);var b;b=k;var c=a;b=r(b);var c=r(c),d;for(d in c)b[d]&&delete b[d];b=E(b);return e(b)};h.where=h.find=function(){return e(w.apply(this,arguments.length?[k].concat(n.call(arguments)):
[k]))};h.select=function(a){var b,c={};arguments.length>1?a=n.call(arguments):j(a)=="s"&&(a=[a]);b=this instanceof Array?this:h.find();for(var d=0,f=a.length;d<f;d++){column=a[d];for(var g=0,i=b.length;g<i;g++)row=b[g],column=="*"?c[g]=p(row):column in row&&(f>1?(c[g]||(c[g]=[]),c[g][d]=row[column]):c[g]=row[column])}return e(p(c))};h.insert=function(a){var g=[],h=[],i=[];arguments.length>1?h=n.call(arguments):j(a)=="a"?h=a:h.push(a);b.unique&&(g=db.find().select(b.unique));l(h,function(a){if(!(b.unique&&
o(g,a[b.unique])!=-1)){var c=d++,e;try{s?k.push(a):(e=new (y()),q(!0,e,a),k.push(e))}catch(f){if(!unsafe)a.constructor=y();k.push(a)}i.push(c)}});f();return e(c(i))};h.update=function(a,b){var c,d;c=this instanceof Array?v(this):h.find();arguments.length==2&&j(a)=="s"&&(d=a,a={},a[d]=b);l(a,function(a,b){j(b)=="f"?l(c,function(c){c[a]=b(c)}):l(c,function(c){c[a]=b})});f();return e(c)};h.remove=function(a){var b,c,d=[];b=this instanceof Array?this:a instanceof Array?a:arguments.length>0?h.find(a):
h.find();m.stain(b);b=k.length;for(var g=k.length-1;g>=0;g--)m.isStained(k[g])?d.push(k[g]):(b-(g+1)&&(c=g+1,k.splice(c,b-c)),b=g);c=g+1;b-c&&k.splice(c,b-c);f();return e(d)};if(arguments.length==1)switch(j(a)){case "a":h.insert(a);break;case "f":h.insert(a());break;case "s":return h.apply(this,arguments);case "o":h.insert(a)}else arguments.length>1&&h.insert(n.call(arguments));h.__raw__=k;return h};window.DB.isin=B;window.DB.find=w;window.DB.has=u;window.DB.type=j;window.DB.each=z;window.DB.values=
p;window.DB.ilike=window.DB.like=x;window.DB.unsafe=function(){s=!0};window.DB.reduceLeft=function(a,f){var e=new Function("ref,x","return ref "+f);return function(c){for(var b=c.length,d=a,f=0;f<b;f++)c[f]&&(d=e(d,c[f]));return d}};window.DB.reduceRight=function(a,f){var e=new Function("ref,x","return ref "+f);return function(c){for(var b=a,d=c.length-1;d>0;d--)b=e(b,c[d]);return b}}})();
