(function(){function A(a){var e={};n(a,function(a){e[a]=!0});return e}function B(a,e){var c=arguments.length,b=c==1?a:e,g,d={};i.isArr(b)?(c=b.length,g=function(a){for(var d=0;d<c;d++)if(q(a,b[d])>-1)return!0;return!1}):g=function(a){return q(a,b)>-1};return c==2?(d={},d[a]=g,d):g}function C(a){return a.length?o.call(a):s(a)}function D(){var a=o.call(arguments),e,c,b,g,d,f,j,k=C(i.isArr(this)?this:a.shift());a.length==2&&i.isStr(a[0])&&(b={},b[a[0]]=a[1],a=[p({},b)]);for(c=0;c<a.length;c++)if(e=a[c],
i.isFun(e)){e=e.single||e;for(d=k.length,j=d-1;j>=0;j--)b=k[j],e(b)&&(d-(j+1)&&(f=j+1,k.splice(f,d-f)),d=j);f=j+1;d-f&&k.splice(f,d-f)}else n(e,function(a,c){if(i.isFun(c))for(d=k.length,j=d-1;j>=0;j--)b=k[j],a in b&&(g=b[a],c(g,b)&&(d-(j+1)&&(f=j+1,k.splice(f,d-f)),d=j));else for(d=k.length,j=d-1;j>=0;j--)b=k[j],a in b&&b[a]===c&&(d-(j+1)&&(f=j+1,k.splice(f,d-f)),d=j);f=j+1;d-f&&k.splice(f,d-f)});return k}function v(){var a=A(o.call(arguments));return function(e){for(var c in a)if(c in e)return!1;
return!0}}function E(a,e){var c,b=arguments.length,g,d={};b==1?g=a:b==2&&(g=e);g=g.toString().toLowerCase();c=function(a){return a.toString().toLowerCase().search(g)>-1};return b==2?(d={},d[a]=c,d):c}function w(a){var e={x:a};return function(a,b){arguments.length==2&&(e[a]=b);return e[a]}}function s(a){var e=[],c;for(c in a)e.push(a[c]);return e}function p(a,e){for(var c,b,g,d,f=arguments.length,j=0;j<f;j++){c=arguments[j];for(var k in c)b=a[k],g=c[k],a!==g&&(g&&(g.constructor==Object||(d=i.isArr(g)))?
(d?(d=!1,b=b&&i.isArr(constructor)?b:[]):b=b&&b.constructor==Object?b:{},a[k]=p(b,g)):g!==void 0&&(a[k]=g))}return a}function F(a,e){var c=[],b;arguments.length==2?(b=a,a=e):b=this;if(i.isArr(b))c=x(b,a);else{var c={},g;for(g in b)i.isFun(b[g])||(c[g]=a.call(this,b[g]))}return c}function y(a){r++;for(var e=0,c=a.length;e<c;e++)a[e].constructor("i",r)}var o=Array.prototype.slice,t=Object.prototype.toString,u={},z={},r=0,i={isFun:function(a){return!(!a||!a.constructor||!a.call||!a.apply)},isStr:function(a){return!!(a===
""||a&&a.charCodeAt&&a.substr)},isNum:function(a){return t.call(a)==="[object Number]"},isArr:[].isArray||function(a){return t.call(a)==="[object Array]"},isObj:function(a){return a==null?String(a)=="object":t.call(a)==="[object Object]"||!0}},q=[].indexOf?function(a,e){return a.indexOf(e)}:function(a,e){for(var c=a.length-1;c!=-1&&e!=a[c];c--);return c},x=[].map?function(a,e){return a.map(e)}:function(a,e){for(var c=[],b=0,g=obj.length;b<g;b++)c.push(e(obj[b],b));return c},n=[].forEach?function(a,
e){if(i.isArr(a))a.forEach(e);else for(var c in a)e(c,a[c])}:function(a,e){if(i.isArr(a))for(var c=0,b=a.length;c<b;c++)e(a[c],c);else for(c in a)e(c,a[c])};n("< <= > >= == === != !==".split(" "),function(a){z[a]=Function("rhs","return function(x){return x"+a+"rhs}")});var G=function(){var a={};return function(e,c){var b,g=arguments.length,d=g==1?e:c||[],f={};d.length?d.length<20&&i.isNum(d[0])?(b=d.join(","),b=a[b]?a[b]:a[b]=new Function("x","return x=="+d.join("||x=="))):b=function(a){return q(d,
a)>-1}:b=i.isFun(d)?function(a){return q(d(),a)>-1}:d;return g==2?(f={},f[e]=b,f):b}}(),H=function(){var a=/^\s*([=<>!]+)['"]*(.*)$/,e,c={};return function(){return function(b,g){var d,f;if(i.isStr(b)){f=b;if(arguments.length==1)if(c[f])d=c[f];else{try{d=new Function("x,rec","return x "+f)}catch(j){d={}}try{d.single=new Function("rec","return "+b)}catch(k){}c[f]=d}arguments.length==2&&i.isStr(g)&&(d={},f=g,c[f]||(c[f]=(e=f.match(a))!==null?z[e[1]](e[2].replace(/['"]$/,"")):new Function("x,rec","return x "+
f)),d[b]=c[f]);return d}}}}(),I=function(a){var e={};n(a,function(a){e[a]=!0});return e}("has hasKey invert missing isin group remove update where select find sort order each like".split(" "));self.DB=function(a,e){function c(){if(!j){j=!0;for(var a=0,b=f.length;a<b;a++)f[a].call(h,l);j=!1}}function b(a){for(var b in I)a[b]=h[b];return a}function g(a){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=l[a[c]];return b}var d={},f=[],j=!1,k=!1,l=[],h=H();h.isin=G;h.has=B;h.like=E;h.each=h.map=F;h.template={create:function(a){k=
a},update:function(a){p(k||{},a)},get:function(){return k},destroy:function(){k=!1}};h.group=function(a){var c={},d=i.isArr(this)?this:h.find();n(d,function(b){c[b[a]]||(c[b[a]]=[]);c[b[a]].push(b)});return b(c)};h.sync=function(a){f.push(a)};h.order=h.sort=function(a,c){var d,e=arguments.length,m,f=i.isArr(this)?this:h.find();i.isFun(a)?d=a:i.isStr(a)&&(e==1?m="x-y":e==2&&(i.isStr(c)&&(c.toLowerCase()=="asc"?m="x-y":c.toLowerCase()=="desc"&&(m="y-x")),typeof m=="undefined"&&(m=c)),i.isStr(m)&&(m=
u[m]?u[m]:u[m]=new Function("x,y","return "+m)),d=function(b,c){return m(b[a],c[a])});return b(o.call(f).sort(d))};h.constrain=function(){var a=p,b=d,c;var e=arguments,m={};e.length==2?(m[e[0]]=e[1],c=m):e.length==1&&(c=e[0]);d=a(b,c)};h.invert=function(a){var c=l,d=[];y(a||this);for(var a=0,e=c.length;a<e;a++)c[a].constructor("i")!=r&&d.push(c[a]);return b(d)};h.where=h.find=function(){return b(D.apply(this,arguments.length?[l].concat(o.call(arguments)):[l]))};h.view=function(a){var b={};h.sync(function(c){var d=
{},e;n(c,function(b){a in b&&(d[b[a]]=b)});for(e in d)e in b?b[e]!==d[e]&&(b[e]=d[e]):b[e]=d[e];for(e in b)e in d||delete b[e]});c();return b};h.missing=function(){return h.find(v.apply(this,o.call(arguments)))};h.hasKey=function(){return h.find(v.apply(this,o.call(arguments))).invert()};h.findFirst=function(){var a=h.find.apply(this,o.call(arguments));return a.length?a[0]:{}};h.select=function(a){var c=i.isArr(this)?this:h.find(),d={};arguments.length>1?a=o.call(arguments):i.isStr(a)&&(a=[a]);n(a,
function(a,b){if(a=="*")d=x(c,s);else for(var e=0,f=c.length;e<f;e++)row=c[e],a in row&&(f>1?(d[e]||(d[e]=[]),d[e][b]=row[a]):d[e]=row[a])});return b(s(d))};h.insert=function(a){var e={},f=[],h=[];arguments.length>1?f=o.call(arguments):i.isArr(a)?f=a:f.push(a);d.unique&&n(l,function(a,b){e[a[d.unique]]=b});n(f,function(a){if(d.unique&&a[d.unique]in e)h.push(e[a[d.unique]]);else{var b=l.length,c;if(k){var f={};n(k,function(a,b){f[a]=i.isFun(b)?b():b});a=p(f,a)}try{c=new (w(b)),p(c,a),l.push(c)}catch(g){a.constructor=
w(b),l.push(a)}h.push(b)}});c();return b(g(h))};h.update=function(a,e){var d=i.isArr(this)?this:h.find(),f;arguments.length==2&&i.isStr(a)&&(f=a,a={},a[f]=e);i.isFun(a)?d.length&&n(d,a):n(a,function(a,b){i.isFun(b)?n(d,function(c){c[a]=b(c)}):n(d,function(c){c[a]=b})});c();return b(d)};h.remove=function(a){var d,e,f=[];d=i.isArr(this)?this:i.isArr(a)?a:arguments.length>0?h.find(a):h.find();y(d);var g=l.length-1;for(d=l.length;g>=0;g--)l[g].constructor("i")==r?f.push(l[g]):(d-(g+1)&&(e=g+1,l.splice(e,
d-e)),d=g);e=g+1;d-e&&l.splice(e,d-e);c();return b(f)};if(arguments.length==1)if(i.isArr(a))h.insert(a);else if(i.isFun(a))h.insert(a());else if(i.isStr(a))return h.apply(this,arguments);else i.isObj(a)&&h.insert(a);else arguments.length>1&&h.insert(o.call(arguments));h.__raw__=l;return h}})();
